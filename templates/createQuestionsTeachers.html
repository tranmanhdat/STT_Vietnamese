{%extends "teachers_Layout.html" %}
{% block title%}
<title>Tạo câu hỏi - Giáo viên</title>
{%endblock%}
{%block script_extra%}
<script src="../static/js/DataTables/datatables.min.js"></script>
<script src="../static/js/DataTables/DataTables-1.11.3/js/dataTables.bootstrap4.min.js"></script>
<script>
     $(document).ready(function(){
        $('#myTable').dataTable({});
     })
</script>   
{%endblock%}
{% block style %}
    <style>
        input{
            border: 0.5px solid #000;
        }
    </style>
{%endblock%}
{% block content %}
<div class="col-9 grid-margin">
    
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Tạo câu hỏi:</h4>
            <form action="/createQuestionsTeachers" class="form-sample" method="POST" >
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group row">
                            <label for="" class="col-sm-3
                                    col-form-label">Số lượng câu hỏi</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" min="1" max="100" id="numQues" name="numQues">
                            </div>
                        </div>
                    </div>
            
                </div>
                <div class="row" id="listQues">

                </div>
                <button type="button" class="btn btn-success" id="btn-submit">Tạo câu hỏi</button>
            </form>
        </div>
    </div>
</div>
{%endblock%}

{% block script%}
<script>
    var numQues_ ;
    $(document).ready(function() {
        var numQues = $("#numQues").val();
        // console.log(numQues)
        // console.log("in da")
        showQuest(numQues);
        $("#numQues").change(function() {
            numQues_ = $(this).val();
            showQuest($(this).val());
        });
        //get list question
        $("#btn-submit").click(function() {
            var contents = $('input[name="listQuestions[]"]').map(function() {
                return $(this).val()
            }).get();
            var levels = $('select[name="listLevels[]"]').map(function(){
                return $(this).val()
            }).get();
            let count=0;
            for (let i=0;i<contents.length;i++){
                if (contents[i]!="") count++;
            }

            if (numQues_!=count){
                console.log(numQues_);
                alert("Vui lòng nhập đủ nội dung các câu!");
                return;
            }
            $.ajax({
                url: '/createQuestionsTeachers',
                type: 'post',
                data: {
                    contents: JSON.stringify(contents),
                    levels: JSON.stringify(levels)
                },
                dataType: "json",
                success: function(res) {
                    if (res.status) {
                        alert("Thêm câu hỏi thành công!");
                        window.location.reload();
                    }
                },
                error: function(error) {
                    console.log(error);
                }
            })
        });
       
        
    //     $("#key").on('keyup',function(event){
    //         event.preventDefault();
    //         var key = $(this).val().toLowerCase();
    //         console.log(key)
    //         $('#tbody tr').filter(function() {
    //             $(this).toggle($(this).text().toLowerCase().indexOf(key)>-1);
    //   });
        // });

    });

    function showQuest(numQues) {
        $("#listQues").html("");
        for (let i = 1; i <= numQues; i++) {
            let res = '<div class="col-md-6">\
                                <div class="form-group row">\
                                    <label class="col-sm-3 col-form-label">Câu hỏi ' + i + '</label>\
                                        <div class="col-sm-9">\
                                            <input type="text" class="form-control" name="listQuestions[]" required/>\
                                        </div>\
                                    <label class="col-sm-3 col-form-label"> Mức độ</label>\
                                            <div class="col-sm-9">\
                                                <select class="col-sm-9" \
                                            class="form-control"\
                                            name="listLevels[]"/>\
                                                <option value="1">1</option>\
                                                <option value="2">2</option>\
                                                <option value="3">3</option>\
                                                <option value="4">4</option>\
                                                <option value="5">5</option>\
                                                <option value="6">6</option>\
                                                <option value="7">7</option>\
                                                <option value="8">8</option>\
                                                <option value="9">9</option>\
                                                <option value="10">10</option>\
                                            </select>\
                                            </div>\
                                </div>\
                        </div>';
            $("#listQues").append(res);
        }
    }
     
</script>
{%endblock%}
